openapi: 3.0.3
info:
  title: Ddoganzip Dinner Delivery Service API
  description: |
    미스터 대박 디너 서비스 백엔드 API

    ## 인증
    - JWT 토큰 기반 인증 사용
    - 로그인 시 `accessToken`과 `refreshToken` 발급
    - API 요청 시 `Authorization: Bearer {accessToken}` 헤더 필요

    ## 역할
    - **CUSTOMER**: 일반 고객 (메뉴 조회, 장바구니, 주문)
    - **STAFF**: 직원 (주문 상태 관리)
  version: 1.0.0
  contact:
    name: Ddoganzip Team

servers:
  - url: http://localhost:8080
    description: Local development server

tags:
  - name: Auth
    description: 인증 관련 API
  - name: Menu
    description: 메뉴 조회 API
  - name: Cart
    description: 장바구니 관리 API
  - name: Orders
    description: 주문 관리 API
  - name: Staff
    description: 직원용 주문 관리 API

paths:
  /api/auth/register:
    post:
      tags:
        - Auth
      summary: 회원가입
      description: 새로운 고객 계정을 생성합니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              email: "user@example.com"
              password: "password123"
              name: "홍길동"
              address: "서울시 강남구"
              phone: "010-1234-5678"
      responses:
        '200':
          description: 회원가입 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                success: true
                message: "Registration successful"
        '400':
          description: 잘못된 요청 (이메일 중복, 유효성 검사 실패)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/login:
    post:
      tags:
        - Auth
      summary: 로그인
      description: 이메일과 비밀번호로 로그인하여 JWT 토큰을 발급받습니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: "user@example.com"
              password: "password123"
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
              example:
                accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                refreshToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                tokenType: "Bearer"
                expiresIn: 3600
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/refresh:
    post:
      tags:
        - Auth
      summary: 토큰 갱신
      description: Refresh 토큰을 사용하여 새로운 Access 토큰을 발급받습니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: 토큰 갱신 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '400':
          description: 잘못된 Refresh 토큰

  /api/auth/logout:
    post:
      tags:
        - Auth
      summary: 로그아웃
      description: 현재 세션을 종료합니다.
      responses:
        '200':
          description: 로그아웃 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/menu/list:
    get:
      tags:
        - Menu
      summary: 메뉴 목록 조회
      description: 사용 가능한 모든 디너 메뉴를 조회합니다. 인증 불필요.
      responses:
        '200':
          description: 메뉴 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MenuListResponse'
              example:
                - id: 1
                  name: "Valentine Dinner"
                  description: "하트 모양과 큐피드 장식이 포함된 로맨틱한 저녁 식사"
                  basePrice: 35000
                - id: 2
                  name: "French Dinner"
                  description: "커피, 와인, 샐러드, 스테이크로 구성된 프랑스식 정찬"
                  basePrice: 30000
                - id: 3
                  name: "English Dinner"
                  description: "에그 스크램블, 베이컨, 빵, 스테이크로 구성된 영국식 저녁"
                  basePrice: 28000
                - id: 4
                  name: "Champagne Feast Dinner"
                  description: "2인 식사, 샴페인, 바게트빵, 커피, 와인, 스테이크가 포함된 호화로운 만찬"
                  basePrice: 80000

  /api/menu/details/{dinnerId}:
    get:
      tags:
        - Menu
      summary: 메뉴 상세 조회
      description: 특정 디너의 상세 정보를 조회합니다. 인증 불필요.
      parameters:
        - name: dinnerId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          example: 1
      responses:
        '200':
          description: 메뉴 상세 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MenuDetailResponse'
        '400':
          description: 메뉴를 찾을 수 없음

  /api/cart:
    get:
      tags:
        - Cart
      summary: 장바구니 조회
      description: 현재 로그인한 사용자의 장바구니를 조회합니다.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 장바구니 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CartResponse'
        '401':
          description: 인증 필요

  /api/cart/items:
    post:
      tags:
        - Cart
      summary: 장바구니에 상품 추가
      description: 장바구니에 새로운 디너 상품을 추가합니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddToCartRequest'
            example:
              dinnerId: 1
              servingStyleId: 2
              quantity: 1
              customizations:
                - action: "ADD"
                  dishId: 8
                  quantity: 1
      responses:
        '200':
          description: 상품 추가 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: 인증 필요

  /api/cart/items/{itemId}/quantity:
    put:
      tags:
        - Cart
      summary: 상품 수량 변경
      description: 장바구니 항목의 수량을 변경합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateQuantityRequest'
            example:
              quantity: 2
      responses:
        '200':
          description: 수량 변경 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/cart/items/{itemId}/options:
    put:
      tags:
        - Cart
      summary: 상품 옵션 변경
      description: 장바구니 항목의 서빙 스타일 및 커스터마이징 옵션을 변경합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOptionsRequest'
      responses:
        '200':
          description: 옵션 변경 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/cart/items/{itemId}:
    delete:
      tags:
        - Cart
      summary: 장바구니에서 상품 삭제
      description: 장바구니에서 특정 항목을 삭제합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 상품 삭제 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/orders/checkout:
    post:
      tags:
        - Orders
      summary: 주문하기
      description: 장바구니의 모든 상품을 주문합니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckoutRequest'
            example:
              deliveryAddress: "서울시 강남구 테헤란로 123"
              deliveryDate: "2024-12-25T19:00:00"
      responses:
        '200':
          description: 주문 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseWithOrderId'

  /api/orders/history:
    get:
      tags:
        - Orders
      summary: 주문 내역 조회
      description: 현재 사용자의 모든 주문 내역을 조회합니다.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 주문 내역 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrderHistoryResponse'

  /api/orders/{orderId}:
    get:
      tags:
        - Orders
      summary: 주문 상세 조회
      description: 특정 주문의 상세 정보를 조회합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 주문 상세 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDetailResponse'

  /api/staff/orders/active:
    get:
      tags:
        - Staff
      summary: 활성 주문 조회
      description: 배달 완료되지 않은 모든 주문을 조회합니다. STAFF 권한 필요.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 활성 주문 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ActiveOrdersResponse'
        '403':
          description: 권한 없음

  /api/staff/orders/{orderId}/status:
    put:
      tags:
        - Staff
      summary: 주문 상태 변경
      description: 주문의 상태를 변경합니다. STAFF 권한 필요.
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrderStatusRequest'
            example:
              status: "IN_KITCHEN"
      responses:
        '200':
          description: 상태 변경 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT 토큰을 사용한 인증

  schemas:
    RegisterRequest:
      type: object
      required:
        - email
        - password
        - name
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6
        name:
          type: string
        address:
          type: string
        phone:
          type: string

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    RefreshTokenRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string

    TokenResponse:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        tokenType:
          type: string
        expiresIn:
          type: integer
          format: int64

    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object

    ApiResponseWithOrderId:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: integer
          format: int64

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        errors:
          type: array
          items:
            type: string

    MenuListResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        basePrice:
          type: number

    MenuDetailResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        basePrice:
          type: number
        dishes:
          type: array
          items:
            $ref: '#/components/schemas/DishInfo'
        availableStyles:
          type: array
          items:
            $ref: '#/components/schemas/ServingStyleInfo'
      example:
        id: 1
        name: "Valentine Dinner"
        description: "하트 모양과 큐피드 장식이 포함된 로맨틱한 저녁 식사"
        basePrice: 35000
        dishes:
          - id: 1
            name: "Steak"
            defaultQuantity: 1
          - id: 2
            name: "Wine"
            defaultQuantity: 1
          - id: 3
            name: "Coffee"
            defaultQuantity: 1
          - id: 4
            name: "Salad"
            defaultQuantity: 1
        availableStyles:
          - id: 1
            name: "Simple"
            additionalPrice: 0
            description: "플라스틱 접시와 컵, 종이 냅킨"
          - id: 2
            name: "Grand"
            additionalPrice: 5000
            description: "도자기 접시와 컵, 흰색 면 냅킨"
          - id: 3
            name: "Deluxe"
            additionalPrice: 10000
            description: "꽃병, 도자기 접시와 컵, 린넨 냅킨"

    DishInfo:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        defaultQuantity:
          type: integer

    ServingStyleInfo:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        additionalPrice:
          type: number
        description:
          type: string

    AddToCartRequest:
      type: object
      required:
        - dinnerId
        - servingStyleId
      properties:
        dinnerId:
          type: integer
          format: int64
        servingStyleId:
          type: integer
          format: int64
        quantity:
          type: integer
          default: 1
          minimum: 1
        customizations:
          type: array
          items:
            $ref: '#/components/schemas/CustomizationRequest'

    CustomizationRequest:
      type: object
      properties:
        action:
          type: string
          enum: [ADD, REMOVE, REPLACE]
        dishId:
          type: integer
          format: int64
        quantity:
          type: integer

    UpdateQuantityRequest:
      type: object
      required:
        - quantity
      properties:
        quantity:
          type: integer
          minimum: 1

    UpdateOptionsRequest:
      type: object
      required:
        - servingStyleId
      properties:
        servingStyleId:
          type: integer
          format: int64
        customizations:
          type: array
          items:
            $ref: '#/components/schemas/CustomizationRequest'

    CartResponse:
      type: object
      properties:
        cartId:
          type: integer
          format: int64
        items:
          type: array
          items:
            $ref: '#/components/schemas/CartItemResponse'
        totalPrice:
          type: number
      example:
        cartId: 1
        items:
          - itemId: 1
            dinnerId: 1
            dinnerName: "Valentine Dinner"
            dinnerBasePrice: 35000
            servingStyleId: 2
            servingStyleName: "Grand"
            servingStylePrice: 5000
            quantity: 2
            itemTotalPrice: 80000
            customizations:
              - action: "ADD"
                dishId: 8
                dishName: "Champagne"
                quantity: 1
        totalPrice: 80000

    CartItemResponse:
      type: object
      properties:
        itemId:
          type: integer
          format: int64
        dinnerId:
          type: integer
          format: int64
        dinnerName:
          type: string
        dinnerBasePrice:
          type: number
        servingStyleId:
          type: integer
          format: int64
        servingStyleName:
          type: string
        servingStylePrice:
          type: number
        quantity:
          type: integer
        itemTotalPrice:
          type: number
        customizations:
          type: array
          items:
            $ref: '#/components/schemas/CustomizationResponse'

    CustomizationResponse:
      type: object
      properties:
        action:
          type: string
        dishId:
          type: integer
          format: int64
        dishName:
          type: string
        quantity:
          type: integer

    CheckoutRequest:
      type: object
      required:
        - deliveryAddress
      properties:
        deliveryAddress:
          type: string
        deliveryDate:
          type: string
          format: date-time

    OrderHistoryResponse:
      type: object
      properties:
        orderId:
          type: integer
          format: int64
        orderDate:
          type: string
          format: date-time
        deliveryDate:
          type: string
          format: date-time
        deliveryAddress:
          type: string
        status:
          $ref: '#/components/schemas/OrderStatus'
        totalPrice:
          type: number
        itemCount:
          type: integer

    OrderDetailResponse:
      type: object
      properties:
        orderId:
          type: integer
          format: int64
        orderDate:
          type: string
          format: date-time
        deliveryDate:
          type: string
          format: date-time
        deliveryAddress:
          type: string
        status:
          $ref: '#/components/schemas/OrderStatus'
        totalPrice:
          type: number
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItemInfo'

    OrderItemInfo:
      type: object
      properties:
        itemId:
          type: integer
          format: int64
        dinnerName:
          type: string
        servingStyleName:
          type: string
        quantity:
          type: integer
        price:
          type: number
        customizations:
          type: array
          items:
            $ref: '#/components/schemas/OrderCustomizationInfo'

    OrderCustomizationInfo:
      type: object
      properties:
        action:
          type: string
        dishName:
          type: string
        quantity:
          type: integer

    ActiveOrdersResponse:
      type: object
      properties:
        orderId:
          type: integer
          format: int64
        customerName:
          type: string
        customerEmail:
          type: string
        orderDate:
          type: string
          format: date-time
        deliveryDate:
          type: string
          format: date-time
        deliveryAddress:
          type: string
        status:
          $ref: '#/components/schemas/OrderStatus'
        totalPrice:
          type: number
        itemCount:
          type: integer

    UpdateOrderStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          $ref: '#/components/schemas/OrderStatus'

    OrderStatus:
      type: string
      enum:
        - CHECKING_STOCK
        - RECEIVED
        - IN_KITCHEN
        - DELIVERING
        - DELIVERED
      description: |
        주문 상태:
        - CHECKING_STOCK: 재고 확인 중
        - RECEIVED: 주문 접수됨
        - IN_KITCHEN: 조리 중
        - DELIVERING: 배달 중
        - DELIVERED: 배달 완료
