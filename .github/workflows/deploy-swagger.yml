# .github/workflows/deploy-swagger.yml

name: Deploy Swagger UI to GitHub Pages

# main 브랜치에 푸시될 때마다 이 워크플로우를 실행합니다.
on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. 리포지토리 코드를 워크플로우 환경으로 가져옵니다.
      - name: Checkout
        uses: actions/checkout@v4

      # 2. JDK 23 환경을 설정합니다. (프로젝트 버전에 맞게 변경)
      - name: Set up JDK 23
        uses: actions/setup-java@v4
        with:
          java-version: '23'
          distribution: 'valhalla'

      # 3. Gradle 실행 권한을 부여합니다.
      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew

      # 4. Gradle 빌드를 실행하여 openapi.yaml 파일을 생성합니다.
      - name: Generate OpenAPI spec
        run: ./gradlew generateOpenApiDocs

      # 5. 생성된 문서를 gh-pages 브랜치에 배포합니다.
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./build/docs # 1단계에서 생성된 파일이 있는 디렉토리
          # 필요하다면 배포 전 커밋 메시지를 지정할 수 있습니다.
          # commit_message: 'Deploy latest Swagger UI'